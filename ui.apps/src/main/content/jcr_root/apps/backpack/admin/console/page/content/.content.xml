<?xml version="1.0" encoding="UTF-8"?>
<jcr:root xmlns:sling="http://sling.apache.org/jcr/sling/1.0" xmlns:granite="http://www.adobe.com/jcr/granite/1.0" xmlns:cq="http://www.day.com/jcr/cq/1.0" xmlns:jcr="http://www.jcp.org/jcr/1.0" xmlns:nt="http://www.jcp.org/jcr/nt/1.0"
          jcr:primaryType="cq:Page">
    <jcr:content
            jcr:mixinTypes="[sling:VanityPath]"
            jcr:primaryType="nt:unstructured"
            jcr:title="Backpack"
            sling:redirect="{Boolean}false"
            sling:resourceType="granite/ui/components/shell/collectionpage"
            sling:vanityOrder="{Long}1200"
            sling:vanityPath="/backpack"
            consoleId="cq-backpack"
            contentPath="${requestPathInfo.suffix}"
            currentView="${state[&quot;shell.collectionpage.layoutId&quot;].string}"
            modeGroup="screens-dcc-collection-resources"
            pageURITemplate="/backpack.html{+id}"
            targetCollection=".screens-dcc-collection-resources">
        <redirector
                jcr:primaryType="nt:unstructured"
                sling:resourceType="granite/ui/components/coral/foundation/admin/contentchecker"
                allowed="[^/$,^/etc/packages/?$,^/etc/packages/backpack/?$]"
                path="${requestPathInfo.suffix}"
                redirectWhenEmpty="/backpack.html/etc/packages/backpack"/>
        <head jcr:primaryType="nt:unstructured">
            <clientlibs
                    jcr:primaryType="nt:unstructured"
                    sling:resourceType="granite/ui/components/coral/foundation/includeclientlibs"
                    categories="[cq.common.wcm,cq.listview.coral.columns.personalization,cq.siteadmin.admin.page.row,cq.gui.coral.common.admin.references,cq.screens.dcc,backpack,coralui3,granite.ui.coral.foundation,granite.operations-dashboard.diagnosis,granite.oak-index-manager.app]"/>
        </head>
        <rails
                jcr:primaryType="nt:unstructured"
                active="{Boolean}true">
            <rail
                    granite:id="searchRail"
                    jcr:primaryType="nt:unstructured"
                    jcr:title="Filter"
                    sling:resourceType="granite/ui/components/coral/foundation/panel/railpanel"
                    active="{Boolean}true"
                    id="searchRail">
                <items
                        jcr:primaryType="nt:unstructured"
                        sling:resourceType="granite/ui/components/coral/foundation/container">
                    <form
                            granite:class="granite-index-search-form"
                            granite:id="indexSearchForm"
                            jcr:primaryType="nt:unstructured"
                            sling:resourceType="granite/ui/components/coral/foundation/form"
                            autosubmitForm="{Boolean}true"
                            style="vertical">
                        <items jcr:primaryType="nt:unstructured">

                            <group_select
                                    granite:id="indexTypeSelect"
                                    jcr:primaryType="nt:unstructured"
                                    sling:resourceType="granite/ui/components/coral/foundation/form/select"
                                    fieldLabel="Group"
                                    name="group">
                                <datasource
                                        jcr:primaryType="nt:unstructured"
                                        dropDownQuery = "SELECT * FROM [sling:Folder] AS node WHERE ISCHILDNODE(node, '/etc/packages') order by node.[jcr:path] asc"
                                        sling:resourceType="backpack/data-sources/group-dynamic-select"/>
                            </group_select>
                            <typehidden
                                    granite:id="indexGroupInput"
                                    jcr:primaryType="nt:unstructured"
                                    sling:resourceType="granite/ui/components/coral/foundation/form/hidden"
                                    value="${param.group}"/>
                        </items>
                    </form>
                </items>
            </rail>
        </rails>
        <views jcr:primaryType="nt:unstructured">
            <card
                    granite:rel="screens-dcc-collection-resources"
                    jcr:primaryType="nt:unstructured"
                    jcr:title="Card View"
                    sling:resourceType="granite/ui/components/coral/foundation/masonry"
                    icon="viewCard"
                    layoutId="card"
                    limit="{Long}20"
                    metaResourceType="screens/dcc/components/page/meta"
                    modeGroup="screens-dcc-collection-resources"
                    path="${requestPathInfo.suffix}"
                    selectionMode="${state[&quot;shell.collectionpage.selectionMode&quot;].boolean}"
                    size="${empty requestPathInfo.selectors[1] ? &quot;20&quot; : requestPathInfo.selectors[1]}"
                    src="/apps/backpack/admin/console/page/content/jcr:content/views/card{.offset,limit}.html{+id}"
                    stateId="shell.collectionpage">
                <datasource
                        jcr:primaryType="nt:unstructured"
                        sling:resourceType="backpack/admin/console/components/packages"
                        itemResourceType="backpack/admin/console/components/card"
                        limit="${empty requestPathInfo.selectors[1] ? &quot;21&quot; : requestPathInfo.selectors[1] + 1}"
                        offset="${requestPathInfo.selectors[0]}"
                        path="${requestPathInfo.suffix}"/>
            </card>
        </views>
        <breadcrumbs
                jcr:primaryType="nt:unstructured"
                sling:resourceType="screens/dcc/components/datasources/breadcrumbs"
                path="${param.group}"/>
        <actions jcr:primaryType="nt:unstructured">
            <secondary jcr:primaryType="nt:unstructured">
                <create
                        jcr:primaryType="nt:unstructured"
                        sling:resourceType="granite/ui/components/coral/foundation/pulldown"
                        text="Create"
                        variant="primary">
                    <items jcr:primaryType="nt:unstructured">
                        <createpackage
                                granite:rel="cq-backpack-createpackage"
                                jcr:primaryType="nt:unstructured"
                                sling:resourceType="granite/ui/components/coral/foundation/collection/actionlink"
                                action="foundation.dialog"
                                icon="experience"
                                target=".screens-dcc-collection-resources"
                                text="Package">
                            <data
                                    jcr:primaryType="nt:unstructured"
                                    nesting="hide"
                                    src.uritemplate="/apps/backpack/admin/console/page/content/createpagedialog.html"/>
                        </createpackage>
                    </items>
                    <granite:rendercondition
                            jcr:primaryType="nt:unstructured"
                            sling:resourceType="granite/ui/components/coral/foundation/renderconditions/privilege"
                            path="${requestPathInfo.suffix}"
                            privileges="jcr:addChildNodes"/>
                </create>
            </secondary>
        </actions>
    </jcr:content>
    <createpagedialog
            jcr:primaryType="nt:unstructured"
            jcr:title="Create package"
            sling:resourceType="granite/ui/components/coral/foundation/dialog">
        <items jcr:primaryType="nt:unstructured">
            <form jcr:primaryType="nt:unstructured"
                  sling:resourceType="granite/ui/components/coral/foundation/form"
                  action="/services/backpack/createPackage"
                  foundationForm="{Boolean}true"
                  maximized="{Boolean}true"
                  method="post"
                  style="vertical">
                <successresponse
                        jcr:primaryType="nt:unstructured"
                        jcr:title="Success"
                        sling:resourceType="granite/ui/components/coral/foundation/form/responses/openprompt"
                        open="/backpack/buildPackage.html/etc/packages/backpack/{packageNodeName}"
                        redirect="/backpack.html${granite:encodeURIPath(requestPathInfo.suffix)}"
                        text="Your package has been created."/>
                        <items jcr:primaryType="nt:unstructured">
                            <content jcr:primaryType="nt:unstructured"
                                     jcr:title="Package setup"
                                     sling:resourceType="granite/ui/components/coral/foundation/fixedcolumns">
                                <items jcr:primaryType="nt:unstructured">
                                    <column jcr:primaryType="nt:unstructured"
                                            sling:resourceType="granite/ui/components/coral/foundation/container">

                                        <items jcr:primaryType="nt:unstructured">
                                            <packageName jcr:primaryType="nt:unstructured"
                                                         sling:resourceType="granite/ui/components/coral/foundation/form/textfield"
                                                         fieldLabel="Package Name"
                                                         name="packageName"
                                                         required="{Boolean}true"/>
                                            <packageVersion jcr:primaryType="nt:unstructured"
                                                            sling:resourceType="granite/ui/components/coral/foundation/form/textfield"
                                                            fieldLabel="Package Version"
                                                            name="version"/>
                                            <paths jcr:primaryType="nt:unstructured"
                                                  fieldLabel="Path"
                                                  name="paths"
                                                  multiple="{Boolean}true"
                                                  required="{Boolean}true"
                                                  sling:resourceType="granite/ui/components/coral/foundation/form/pathfield"/>
                                            <excludeChildren jcr:primaryType="nt:unstructured"
                                                      fieldDescription="Check to exclude child pages from package filter"
                                                      name="excludeChildren"
                                                      text="Exclude child pages?"
                                                      uncheckedValue="false" value="true"
                                                      sling:resourceType="granite/ui/components/coral/foundation/form/checkbox"/>
                                            <create
                                                    jcr:primaryType="nt:unstructured"
                                                    sling:resourceType="granite/ui/components/coral/foundation/button"
                                                    text="Create"
                                                    type="submit"
                                                    variant="primary"/>
                                        </items>
                                    </column>
                                </items>
                            </content>
                </items>
            </form>
        </items>
    </createpagedialog>
</jcr:root>
